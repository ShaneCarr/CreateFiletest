
# Effectively this likely does a dgpr style deletion
# $g = Get-UnifiedGroup
# $g | % {Remove-UnifiedGroup $_.Id -force -Confirm:$false} 

# create a network
#https://www.yammer.com/api/v1/uploaded_files/333353582592/download
# 14690197504


#"www.staging.yammer.com"
#"49984929792-Lz3BU7qgx2Cz4uWObgJVfw"
#$domain = "a830edad9050849902e19121203.ccsctp.net"
#$filesUrl = "filesng.staging.yammer.com"
#$filesCdn = "https://stagefilescdn.yammer.com"
#$authority = "stagefilescdn.yammer.com"
#$filesUrl = "filesng.staging.yammer.com"


$authToken= "17399332864-qMsgKGxdRZ7CGAYi5DiwYg"   
$environment = "www.yammer.com" 
$domain = "a830edad9050849514E20020311.onmicrosoft.com"

$filesUrl = "filesng.yammer.com"
$filesCdn = "https://filescdn.yammer.com"
$authority = "filescdn.yammer.com"
$referer = "https://www.yammer.com/a830edad9050849514E20020311.onmicrosoft.com"
$origin = "https://www.yammer.com"

$MyArrayList = [System.Collections.ArrayList]@()
For ($i=0; $i -le 10; $i++) {

$gName = $i.ToString() + "A_Generated_Group"
     #Invoke-WebRequest -Uri "https://www.yammer.com/api/v1/groups" -Method "POST" -Headers @{"method"="POST"; "authority"="www.yammer.com"; "scheme"="https"; "path"="/api/v1/groups"; "x-app-version"="52072c16c0bf94c5d0fc93c888ecdab4208da2f2"; "x-csrf-token"="bO7XxnvmHCk/IvdrJ2LV8QPXu7NokvOtQUO4BQTrlDU="; "x-requested-with"="XMLHttpRequest"; "authorization"="Bearer 14690197504-G3lricGvmGf1aYhXpi3AOQ"; "x-app-load-id"="1580770136223.1169154"; "accept"="application/json, text/javascript, */*; q=0.01"; "yammer-capabilities"="external-messaging,user-sidebar,external-groups,parsed-body-only2"; "x-app-environment"="azure_production"; "user-agent"="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"; "x-app-context"=""; "x-app-load-time"="1580770136223"; "x-app-event-time"="1580770798396"; "x-app-source-location-id"=""; "origin"="https://www.yammer.com"; "sec-fetch-site"="same-origin"; "sec-fetch-mode"="cors"; "referer"="https://www.yammer.com/a830edad9050849337i19120523.onmicrosoft.com/"; "accept-encoding"="gzip, deflate, br"; "accept-language"="en-US,en;q=0.9"; "cookie"="yamtrak_id=4a5b152f-d309-4be1-8d6c-69a44549bffd; mobile_view=disabled; locale=en-US; MSFPC=GUID=498860b007404269934530bb4c1600a3&HASH=4988&LV=201912&V=4&LU=1575681903602; _log_sso_success=1; unverified_email=admin%40a830edad9050849656J19120523.onmicrosoft.com; browser_token=%242a%2410%24.IMWElCLT0LENWoaL5gvtusi7a7Xh8QalQJOdnL0dv1nDjS2W9i2i; logged_in_from_office365=true; last_network=a830edad9050849337i19120523.onmicrosoft.com; _session=BAh7CUkiD3Nlc3Npb25faWQGOgZFVEkiJTc4ZjA5NjM5YmMyYTNlYmE4OThlYzA0MWZiNTc5MTQyBjsAVEkiC21vYmlsZQY7AEZGSSIQX2NzcmZfdG9rZW4GOwBGSSIxYk83WHhudm1IQ2svSXZkckoyTFY4UVBYdTdOb2t2T3RRVU80QlFUcmxEVT0GOwBGSSIdbG9nZ2VkX2luX2Zyb21fb2ZmaWNlMzY1BjsARlQ%3D--1770c67168780df5dd7135c3290f97be48153828; login_csrf_token=; oauth_token=14690197504-G3lricGvmGf1aYhXpi3AOQ; return_to=%2Fa830edad9050849337i19120523.onmicrosoft.com%2F; office_access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkhsQzBSMTJza3hOWjFXUXdtak9GXzZ0X3RERSIsImtpZCI6IkhsQzBSMTJza3hOWjFXUXdtak9GXzZ0X3RERSJ9.eyJhdWQiOiJodHRwczovL3d3dy55YW1tZXIuY29tLyIsImlzcyI6Imh0dHBzOi8vc3RzLndpbmRvd3MubmV0LzA3NmJhMzQ4LTY4NWEtNGEzZS1hMGYxLTY4MzA2Y2JhNTlmMS8iLCJpYXQiOjE1ODA3NjkxMjksIm5iZiI6MTU4MDc2OTEyOSwiZXhwIjoxNTgwNzczMDI5LCJhY3IiOiIxIiwiYWlvIjoiQVNRQTIvOE9BQUFBbWRqTjVKVnhRclpOQjV0R1o1Qnl0RmFwWHJmWmZIRXF1M3RJRHB2YjNtWT0iLCJhbXIiOlsicHdkIl0sImFwcGlkIjoiMDAwMDAwMDUtMDAwMC0wZmYxLWNlMDAtMDAwMDAwMDAwMDAwIiwiYXBwaWRhY3IiOiIwIiwiZmFtaWx5X25hbWUiOiJEb2UiLCJnaXZlbl9uYW1lIjoiSm9obiIsImlwYWRkciI6IjEzMS4xMDcuMTU5LjIzMyIsIm5hbWUiOiJURVNUX1RFU1RfU1BPUHJvdkhlYXJ0YmVhdF9PMzY1RTNFTVNfMTVfMTkxMjA1MjMwMF8zMzciLCJvaWQiOiIzOThkMmQyNS0wYmM0LTQ0ZGQtYjQ3YS1hMDA2ZjllZTJhZWIiLCJwdWlkIjoiMTAwMzIwMDA4RTFEQ0MzNyIsInNjcCI6InVzZXJfaW1wZXJzb25hdGlvbiIsInNpZ25pbl9zdGF0ZSI6WyJrbXNpIl0sInN1YiI6InZMVEpsZkZySlcwSVlnaW51RFJtcWVQc050ZnZXajBqUlJrbkx1V2tvZXMiLCJ0aWQiOiIwNzZiYTM0OC02ODVhLTRhM2UtYTBmMS02ODMwNmNiYTU5ZjEiLCJ1bmlxdWVfbmFtZSI6ImFkbWluQGE4MzBlZGFkOTA1MDg0OTMzN0kxOTEyMDUyMy5vbm1pY3Jvc29mdC5jb20iLCJ1cG4iOiJhZG1pbkBhODMwZWRhZDkwNTA4NDkzMzdJMTkxMjA1MjMub25taWNyb3NvZnQuY29tIiwidXRpIjoia0pRblBVbUlRVXVPVmwzZzdSRVRBQSIsInZlciI6IjEuMCJ9.OA96pR2rxcqYY5dJUEIHH2oio-NGsxl5w1c-26NPYDhQLMyiOq7DWslSKEPPOloI_WksgEimsiSFZa6Qtkge69VUR-2lhKn67WBBve7W-g4tqhto60hc-P5qXmO5yDmtMmRzrdja054mih5KC_i0x2HKFe-VP_NcWY2H53X8bil7nXakdgdwZiwcAJKZ4kXDwrIJGOJqktczfPDuOf-mTco38cly3gA3ZP15dG4PEfBDl4B9FC8ych4tYoH9GEK22jzE9I05e6C733kVRXoZywkOepYhFFKBCUbCdYIPDSROx5YGQO-rwzTAX3TVB7Z4OaHaq4k9msH0OC_Kdm93cA"} -ContentType "application/x-www-form-urlencoded; charset=UTF-8" -Body "name=$gName&notify=true&invites%5Buser_ids%5D=&invites%5Bemails%5D=&category=unclassified&show_in_directory=false&private=true&access_token=14690197504-G3lricGvmGf1aYhXpi3AOQ"
     $response = Invoke-WebRequest -Uri ("https://"+$environment+"/api/v1/groups") -Method "POST" -Headers @{"method"="POST"; "authority"=""+$environment; "scheme"="https"; "path"="/api/v1/groups"; "x-requested-with"="XMLHttpRequest"; "authorization"="Bearer " + $authToken.ToString(); "accept"="application/json, text/javascript, */*; q=0.01"; "yammer-capabilities"="external-messaging,user-sidebar,external-groups,parsed-body-only2"; "user-agent"="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"; "x-app-context"=""; "x-app-load-time"="1580185164532"; "x-app-event-time"="1580185191469"; "x-app-source-location-id"=""; "origin"="$origin"; "sec-fetch-site"="same-origin"; "sec-fetch-mode"="cors"; "referer"=$referer; "accept-encoding"="gzip, deflate, br"; "accept-language"="en-US,en;q=0.9"; "cookie"="yamtrak_id=41814b9f-7f5b-4183-be43-8f89d276ecc0; mobile_view=disabled; locale=en-US; MSFPC=GUID=b3b53c54092a4d04b4dde529b0445a59&HASH=b3b5&LV=202001&V=4&LU=1578715193032; _log_sso_success=1; login_csrf_token=; browser_token=%242a%2410%24eABhCVv2f%2F3lAYOM5eSBp.9GJau6pOSKvUHuwejFXkffEjBTj.ZvS; logged_in_from_office365=true; oauth_token="+$authToken+"; last_network="+$domain +"; return_to=%2Fa"+$domain +"%2F; yamtrak_id=31a39a2b-9de9-4cce-8b21-1f67436c8c40; _session=BAh7CUkiD3Nlc3Npb25faWQGOgZFVEkiJWQ3NzE0NGFlOGMwNTFkYzllMDEyNjM4MDQzNmNjNzk3BjsAVEkiC21vYmlsZQY7AEZGSSIQX2NzcmZfdG9rZW4GOwBGSSIxMklqY0l3Y1B0MWFqSWt5UExFT3hyL29jQk9zYkF6QkZiaDhQcEhkNHNTaz0GOwBGSSIdbG9nZ2VkX2luX2Zyb21fb2ZmaWNlMzY1BjsARlQ%3D--cceee4026f46f2fa59085dfd67fe491bce2372b7; office_access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik9vTjZScnpSdldaSUFZTDhiNHNFd2lRdkY4cyIsImtpZCI6Ik9vTjZScnpSdldaSUFZTDhiNHNFd2lRdkY4cyJ9.eyJhdWQiOiJodHRwczovL3d3dy5zdGFnaW5nLnlhbW1lci5jb20vIiwiaXNzIjoiaHR0cHM6Ly9zdHMud2luZG93cy1wcGUubmV0LzgyOGRmNmIxLTIxMWMtNDZmNi1hODE3LTllNDk0MDdkOWJhZS8iLCJpYXQiOjE1ODAxODQ4NjEsIm5iZiI6MTU4MDE4NDg2MSwiZXhwIjoxNTgwMTg4NzYxLCJhY3IiOiIxIiwiYWlvIjoiRTJSZ1lOQjZiYXV2K2tyS1g4d3E2bE9uSUxkdFkvU2xoa2ZLd2htSzFtMTNuVlZGOVFBPSIsImFtciI6WyJwd2QiXSwiYXBwaWQiOiIwMDAwMDAwNS0wMDAwLTBmZjEtY2UwMC0wMDAwMDAwMDAwMDAiLCJhcHBpZGFjciI6IjAiLCJmYW1pbHlfbmFtZSI6IkRvZSIsImdpdmVuX25hbWUiOiJKb2huIiwiaXBhZGRyIjoiMTY3LjIyMC4yLjEwNSIsIm5hbWUiOiJURVNUX1RFU1RfU1BPUHJvdkhlYXJ0YmVhdF9FM18xNV8xOTEyMTIwMzAwXzE5MDIiLCJvaWQiOiI1NThlNTM5Zi01N2FjLTRkOGYtYjM0Yi1mZmU4OWVhZDRkNTEiLCJwdWlkIjoiMTAwM0RGRkQwMDIzNzlFMCIsInNjcCI6InVzZXJfaW1wZXJzb25hdGlvbiIsInNpZ25pbl9zdGF0ZSI6WyJrbXNpIl0sInN1YiI6IkJsc2wteUxuOUl1NWpDU19mQnIzazlVVDNHUDFZN29JZ1BLYzMtejdIRmciLCJ0aWQiOiI4MjhkZjZiMS0yMTFjLTQ2ZjYtYTgxNy05ZTQ5NDA3ZDliYWUiLCJ1bmlxdWVfbmFtZSI6ImFkbWluQGE4MzBlZGFkOTA1MDg0OTkwMkUxOTEyMTIwMy5jY3NjdHAubmV0IiwidXBuIjoiYWRtaW5AYTgzMGVkYWQ5MDUwODQ5OTAyRTE5MTIxMjAzLmNjc2N0cC5uZXQiLCJ1dGkiOiJDYlA5REwwcnFVU2VxQnJnWDFod0FBIiwidmVyIjoiMS4wIn0.ZWkImJKxin57e1Sam66amj6B_p_yRTSlxWqJyKiPwS-l8VCTaF4DNgGwS-eQukcnPPbnAgbLyBfKZxcb0obE6c6d5ZhvXLdQe4xKHqH7bSa8UjAipp4zI6PGrf5zF-xc3QUiPa_pxMiQ5xeSSi1ui-tT_OncYpyKRqBXLt_FU-oBQokJ2wqaSoaD-hNBg7GEk_nPTo2w3fcRrzwRbjwGNGeLIycXu7K-_9f-0FX6FFw99EQ0r0HKs6Ru99hMq6XNRkbsBTTLtolWY0lLxghdRfBsf-LsjY3kiAnP_rK7LoQVhQqDM0G0TXqi5jatVza4DdTET8OR74xDoTCdJSAjMQ"} -ContentType "application/x-www-form-urlencoded; charset=UTF-8" -Body ("name=$gName&notify=true&invites%5Buser_ids%5D=&invites%5Bemails%5D=&category=unclassified&show_in_directory=false&private=true&access_token="+$authToken)
     $result = ConvertFrom-JSON  $response.Content
     $result.id
     $MyArrayList.add($result)
    }

#upload one file
Foreach ($i in $MyArrayList)
{

For ($ix=0; $ix -le 500; $ix++) {
    $name =New-Guid
    $responseCreate = Invoke-WebRequest -Uri ("https://"+$filesUrl+"/v3/createUploadSession") -Method "POST" -Headers @{"method"="POST"; "authority"=""+$filesUrl+""; "scheme"="https"; "path"="/v3/createUploadSession"; "accept"="application/json, text/javascript, */*; q=0.01"; "authorization"="Bearer "+$authToken+""; "user-agent"="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"; "origin"="https://www.yammer.com"; "sec-fetch-site"="same-site"; "sec-fetch-mode"="cors"; "referer"="https://www.yammer.com/"; "accept-encoding"="gzip, deflate, br"; "accept-language"="en-US,en;q=0.9"} -ContentType "application/json; charset=UTF-8" -Body ("{`"filename`":`"" + $name.ToString() + "`",`"is_all_company`":false,`"group_id`":" + $i.id + ",`"network_id`":" + $i.network_id + ",`"upload_job_id`":`"74088fbd-0dc3-f185-a88b-d33f6e1910ec`"}")
    $resultCreate = ConvertFrom-JSON  $responseCreate.Content
    $random = Get-Random -Maximum 10000

    $s = -join ((65..90) + (97..122) | Get-Random -Count 50 | % {[char]$_})
    $fileContent = $s+ $s +$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s+$s
    Invoke-WebRequest -Uri $resultCreate.url -Method "PUT" -Headers @{"method"="PUT"; "authority"=""+$authority+""; "scheme"="https"; "path"=""+$resultCreate.url.Replace($filesCdn, "")+""; "x-ms-blob-type"="BlockBlob"; "x-ms-version"="2018-03-28"; "x-ms-client-request-id"="deab4b4a-7737-4cb1-8285-033ef288c339"; "user-agent"="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"; "accept"="*/*"; "origin"="https://"+$environment+""; "sec-fetch-site"="same-site"; "sec-fetch-mode"="cors"; "referer"="https://"+$environment+"/"; "accept-encoding"="gzip, deflate, br"; "accept-language"="en-US,en;q=0.9"} -ContentType "application/octet-stream" -Body $fileContent
    #$resultComplete = Invoke-WebRequest -Uri ("https://"+$filesUrl+"/v3/completeDirectUploadSession") -Method "POST" -Headers @{"method"="POST"; "authority"=""+$filesUrl+""; "scheme"="https"; "path"="/v3/completeDirectUploadSession"; "accept"="application/json, text/javascript, */*; q=0.01"; "authorization"="Bearer "+$authToken+""; "user-agent"="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"; "origin"="https://"+$environment+""; "sec-fetch-site"="same-site"; "sec-fetch-mode"="cors"; "referer"="https://"+$environment+"/"; "accept-encoding"="gzip, deflate, br"; "accept-language"="en-US,en;q=0.9"} -ContentType "application/json; charset=UTF-8" -Body "{`"is_new_file`":true,`"filename`":`"1 - Copy (21).txt`",`"group_id`":22546513920,`"network_id`":49984929792,`"uploaded_file_id`":38303612928,`"uploaded_file_version_id`":38949593088,`"is_all_company`":false}"
    $resultComplete = Invoke-WebRequest -Uri ("https://"+$filesUrl+"/v3/completeDirectUploadSession") -Method "POST" -Headers @{"method"="POST"; "authority"=""+$filesUrl+""; "scheme"="https"; "path"="/v3/completeDirectUploadSession"; "accept"="application/json, text/javascript, */*; q=0.01"; "authorization"="Bearer "+$authToken+""; "user-agent"="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36"; "origin"="https://"+$environment+""; "sec-fetch-site"="same-site"; "sec-fetch-mode"="cors"; "referer"="https://"+$environment+"/"; "accept-encoding"="gzip, deflate, br"; "accept-language"="en-US,en;q=0.9"} -ContentType "application/json; charset=UTF-8" -Body ("{`"is_new_file`":true,`"filename`":`""+$name.ToString() +"`",`"group_id`":" + $i.id + ",`"network_id`":" + $i.network_id + ",`"uploaded_file_id`":"+$resultCreate.uploaded_file_id+",`"uploaded_file_version_id`":"+$resultCreate.uploaded_file_id+",`"is_all_company`":false}")
    }
}